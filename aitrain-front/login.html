<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Iniciar Sesi√≥n - AiTrain</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Inter,Segoe UI,Arial,Helvetica,sans-serif}
body{
  background:#0d0d0d;
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:100vh;
  padding:20px;
}
.card{
  background:#1a1a1a;
  border-radius:12px;
  border:2px solid #ef4444; /* borde ne√≥n rojo */
  box-shadow:0 0 20px #ef4444,0 8px 30px rgba(2,6,23,0.5);
  width:100%;
  max-width:920px;
  display:flex;
  overflow:hidden;
}
.left{
  flex:1;
  padding:40px;
  background:#000;
  color:#fff;
  display:flex;
  flex-direction:column;
  justify-content:center;
  gap:16px;
}
.left .logo{display:flex;gap:12px;align-items:center}
.left .logo img{width:64px;height:auto}
.left h1{font-size:28px;margin-top:6px;color:#fff}
.left p{color:rgba(255,255,255,0.8);max-width:320px;line-height:1.4}
.right{
  flex:1;
  padding:40px 45px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  gap:16px;
  background:#1a1a1a;
}
h2{font-size:24px;color:#fff;margin-bottom:4px;font-weight:700}
p.sub{color:#ccc;margin-bottom:12px}
form{display:flex;flex-direction:column;gap:14px}
label{font-size:13px;color:#ccc;margin-bottom:6px;display:block}
input[type="email"],input[type="password"], select{
  width:100%;
  padding:10px 12px;
  border-radius:8px;
  border:1px solid #555;
  background:#222;
  color:#fff;
  outline:none;
  font-size:14px;
  transition:all 0.2s ease;
}
input::placeholder{color:#888}
input:focus, select:focus{border-color:#ef4444;box-shadow:0 0 8px #ef4444;}
button{
  background:#ef4444;
  color:#fff;
  border:none;
  padding:12px;
  border-radius:8px;
  font-weight:600;
  cursor:pointer;
  transition:all 0.3s ease;
}
button:hover{background:#ff1a1a;transform:scale(1.03)}
#mensaje{
  text-align:center;
  padding:10px;
  border-radius:8px;
  display:none;
  margin-top:10px;
  font-size:14px;
}
@media (max-width:780px){.left{display:none}}
</style>
</head>
<body>
<div class="card" role="main">
  <div class="left" aria-hidden="true">
    <div class="logo">
      <img src="brazo.png" alt="AiTrain logo" />
      <div style="font-weight:700;font-size:18px">Ai<span style="color:#ef4444">Train</span></div>
    </div>
    <h1>Entrena con inteligencia</h1>
    <p>Accede a tu cuenta y contin√∫a tu progreso con rutinas personalizadas y seguimiento por IA.</p>
  </div>

  <div class="right">
    <div>
      <h2>Iniciar Sesi√≥n</h2>
      <p class="sub">Accede con tu correo y contrase√±a.</p>
    </div>

    <form id="loginForm" novalidate>
      <div>
        <label for="email">Correo electr√≥nico</label>
        <input id="email" type="email" placeholder="usuario@aitrain.com" required />
      </div>

      <div>
        <label for="password">Contrase√±a</label>
        <input id="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="4" />
      </div>

      <div>
        <label for="tipo">Tipo de cuenta</label>
        <select id="tipo" required>
          <option value="usuario" selected>Usuario</option>
          <option value="admin">Admin</option>
        </select>
      </div>

      <button type="submit">Iniciar Sesi√≥n</button>

      <div id="mensaje" role="status"></div>

      <p style="text-align:center;margin-top:10px;font-size:14px;color:#ccc">
        ¬øNo tienes cuenta?
        <a href="registro.html" style="color:#ef4444;font-weight:600;text-decoration:none">Reg√≠strate</a>
      </p>
    </form>
  </div>
</div>

<script>
const API_ADMIN = 'http://localhost:8080/api/aitrain/auth/loginAdmin';
const API_USUARIO = 'http://localhost:8080/api/aitrain/auth/loginUsuario';

const form = document.getElementById('loginForm');
const mensajeDiv = document.getElementById('mensaje');

function mostrarMensaje(text, tipo='info'){
  mensajeDiv.style.display='block';
  mensajeDiv.textContent=text;
  mensajeDiv.style.transition='all 0.3s ease';
  if(tipo==='ok'){ mensajeDiv.style.background='#0a261f'; mensajeDiv.style.color='#0fff90'; mensajeDiv.style.border='1px solid #0fff90'; }
  else if(tipo==='error'){ mensajeDiv.style.background='#2a0a0a'; mensajeDiv.style.color='#ff4d4d'; mensajeDiv.style.border='1px solid #ff4d4d'; }
  else{ mensajeDiv.style.background='#1a1a2e'; mensajeDiv.style.color='#ccc'; mensajeDiv.style.border='1px solid #555'; }
}

form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  mensajeDiv.style.display='none';

  const email=document.getElementById('email').value.trim();
  const password=document.getElementById('password').value;
  const tipo=document.getElementById('tipo').value;

  if(!email || !password){
    mostrarMensaje('‚ö†Ô∏è Por favor ingresa todos los campos','error');
    return;
  }

  const API=tipo==='admin'?API_ADMIN:API_USUARIO;

  try{
    mostrarMensaje('üîÑ Iniciando sesi√≥n...','info');
    const res=await fetch(API,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ email,password })
    });

    const text=await res.text();
    let data;
    try{ data=JSON.parse(text); }catch{ data=text; }

    if(res.ok){
      mostrarMensaje('‚úÖ Sesi√≥n iniciada correctamente','ok');
      localStorage.setItem('aitrain_logged','true');
      localStorage.setItem('aitrain_user',email);
      localStorage.setItem('aitrain_tipo',tipo);

      setTimeout(()=>{
        if(tipo==='admin') window.location.href='dashboard_admin.html';
        else window.location.href='dashboard_usuario.html';
      },1000);

    }else{
      // muestra el mensaje que devuelva el backend
      mostrarMensaje('‚ùå '+(typeof data==='string'?data:data.message||'Credenciales incorrectas'),'error');
    }

  }catch(err){
    console.error(err);
    mostrarMensaje('‚ö†Ô∏è No se pudo conectar al servidor','error');
  }
});
</script>
</body>
</html>
